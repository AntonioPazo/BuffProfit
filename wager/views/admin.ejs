<%- include('partials/header', { title: 'Admin Panel', username: username }) %>

<div class="adm-main-container">
    <!-- Background Effects -->
    <div class="adm-bg-effects">
        <div class="adm-gradient-orb-1"></div>
        <div class="adm-gradient-orb-2"></div>
        <div class="adm-gradient-orb-3"></div>
    </div>
    
    <div class="adm-content-wrapper">
        <!-- Sidebar -->
        <div class="adm-sidebar">
            <div class="adm-sidebar-section">
                <h3 class="adm-sidebar-title">ADMIN PANEL</h3>
                <div class="adm-nav-menu">
                    <a href="#tournaments" class="adm-nav-item adm-nav-active">
                        <i class="fas fa-trophy"></i>
                        <span>Torneos</span>
                    </a>
                    <a href="#users" class="adm-nav-item">
                        <i class="fas fa-users"></i>
                        <span>Usuarios</span>
                    </a>
                    <a href="#matches" class="adm-nav-item">
                        <i class="fas fa-gamepad"></i>
                        <span>Partidas</span>
                    </a>
                    <a href="#disputes" class="adm-nav-item">
                        <i class="fas fa-exclamation-triangle"></i>
                        <span>Disputas</span>
                    </a>
                    <a href="#stats" class="adm-nav-item">
                        <i class="fas fa-chart-bar"></i>
                        <span>Estadísticas</span>
                    </a>
                </div>
            </div>
            
            <div class="adm-sidebar-section">
                <h3 class="adm-sidebar-title">ACCIONES RÁPIDAS</h3>
                <div class="adm-quick-actions">
                    <button id="createTournamentBtn" class="adm-quick-action-btn">
                        <i class="fas fa-plus"></i>
                        <span>Crear Torneo</span>
                    </button>
                    <a href="/admin/disputes" class="adm-quick-action-btn">
                        <i class="fas fa-gavel"></i>
                        <span>Ver Disputas</span>
                    </a>
                    <button class="adm-quick-action-btn">
                        <i class="fas fa-chart-line"></i>
                        <span>Estadísticas</span>
                    </button>
                </div>
            </div>
            
            <div class="adm-sidebar-footer">
                <a href="/matchfinder" class="adm-back-link">
                    <i class="fas fa-arrow-left"></i>
                    <span>Volver a Matchfinder</span>
                </a>
            </div>
        </div>
        
        <!-- Main Content -->
        <div class="adm-main-content">
            <!-- Header -->
            <div class="adm-content-header">
                <div class="adm-header-content">
                    <h1 class="adm-page-title">PANEL DE ADMINISTRACIÓN</h1>
                    <p class="adm-page-subtitle">Gestiona torneos, usuarios y más</p>
                </div>
            </div>
            
            <!-- Alerts -->
            <% if (typeof message !== 'undefined' && message) { %>
                <div class="adm-alert adm-alert-success">
                    <i class="fas fa-check-circle"></i>
                    <div class="adm-alert-content">
                        <% if (message === 'tournament-created') { %>
                            <strong>¡Éxito!</strong> Torneo creado correctamente.
                        <% } else if (message === 'tournament-deleted') { %>
                            <strong>¡Éxito!</strong> Torneo eliminado correctamente.
                        <% } else if (message === 'tournament-updated') { %>
                            <strong>¡Éxito!</strong> Torneo actualizado correctamente.
                        <% } else if (message === 'team-removed') { %>
                            <strong>¡Éxito!</strong> Equipo eliminado del torneo correctamente.
                        <% } else { %>
                            <%= message %>
                        <% } %>
                    </div>
                </div>
            <% } %>
            
            <% if (typeof error !== 'undefined' && error) { %>
                <div class="adm-alert adm-alert-error">
                    <i class="fas fa-exclamation-circle"></i>
                    <div class="adm-alert-content">
                        <% if (error === 'failed-to-create-tournament') { %>
                            <strong>Error:</strong> No se pudo crear el torneo.
                        <% } else if (error === 'tournament-not-found') { %>
                            <strong>Error:</strong> Torneo no encontrado.
                        <% } else if (error === 'server-error') { %>
                            <strong>Error:</strong> Error del servidor. Inténtalo de nuevo más tarde.
                        <% } else if (error === 'failed-to-update-tournament') { %>
                            <strong>Error:</strong> Error al actualizar el torneo.
                        <% } else if (error === 'failed-to-remove-team') { %>
                            <strong>Error:</strong> Error al eliminar el equipo del torneo.
                        <% } else if (error === 'invalid-summoner-format') { %>
                            <strong>Error:</strong> Formato de ID Summoner inválido. Debe ser: nombre#región (ej: player#euw)
                        <% } else if (error === 'user-already-exists') { %>
                            <strong>Error:</strong> El usuario, email o ID Summoner ya existe.
                        <% } else if (error === 'username-email-or-id-exists') { %>
                            <strong>Error:</strong> El nombre de usuario, email o ID Summoner ya existe.
                        <% } else { %>
                            <%= error %>
                        <% } %>
                    </div>
                </div>
            <% } %>
            
            <!-- Tournaments Section -->
            <div id="tournaments" class="adm-section">
                <div class="adm-section-header">
                    <div class="adm-section-title">
                        <i class="fas fa-trophy"></i>
                        <h2>GESTIÓN DE TORNEOS</h2>
                    </div>
                    <button id="createTournamentBtn2" class="adm-btn adm-btn-primary">
                        <i class="fas fa-plus"></i>
                        <span>Crear Nuevo Torneo</span>
                    </button>
                </div>
                
                <div class="adm-card">
                    <% if (tournaments && tournaments.length > 0) { %>
                        <div class="adm-table-container">
                            <table class="adm-table">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Nombre</th>
                                        <th>Fecha</th>
                                        <th>Formato</th>
                                        <th>Participantes</th>
                                        <th>Premio</th>
                                        <th>Estado</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <% tournaments.forEach(tournament => { %>
                                        <tr>
                                            <td><%= tournament.id_tournament %></td>
                                            <td class="adm-table-primary"><%= tournament.name %></td>
                                            <td><%= new Date(tournament.start_date).toLocaleString() %></td>
                                            <td><%= tournament.team_size %> - <%= tournament.format %></td>
                                            <td><%= tournament.current_participants %>/<%= tournament.max_participants %></td>
                                            <td class="adm-table-highlight"><%= tournament.prize_pool %> Credits</td>
                                            <td>
                                                <span class="adm-status-badge adm-status-<%= tournament.status.toLowerCase() %>">
                                                    <%= tournament.status %>
                                                </span>
                                            </td>
                                            <td class="adm-table-actions">
                                                <div class="adm-action-buttons">
                                                    <a href="/view-tournament/<%= tournament.id_tournament %>" class="adm-action-btn adm-view-btn" title="Ver detalles">
                                                        <i class="fas fa-eye"></i>
                                                    </a>
                                                    <a href="/edit-tournament/<%= tournament.id_tournament %>" class="adm-action-btn adm-edit-btn" title="Editar torneo">
                                                        <i class="fas fa-edit"></i>
                                                    </a>
                                                    <a href="/delete-tournament/<%= tournament.id_tournament %>" class="adm-action-btn adm-delete-btn" 
                                                       onclick="return confirm('¿Estás seguro de que deseas eliminar este torneo?')" title="Eliminar torneo">
                                                        <i class="fas fa-trash-alt"></i>
                                                    </a>
                                                </div>
                                            </td>
                                        </tr>
                                    <% }); %>
                                </tbody>
                            </table>
                        </div>
                    <% } else { %>
                        <div class="adm-empty-state">
                            <div class="adm-empty-icon">
                                <i class="fas fa-trophy"></i>
                            </div>
                            <h3>No hay torneos creados</h3>
                            <p>Crea un nuevo torneo para comenzar</p>
                            <button id="createTournamentBtn3" class="adm-btn adm-btn-primary">
                                <i class="fas fa-plus"></i>
                                <span>Crear Nuevo Torneo</span>
                            </button>
                        </div>
                    <% } %>
                </div>
            </div>
            
            <!-- Users Section -->
            <div id="users" class="adm-section" style="display: none;">
                <div class="adm-section-header">
                    <div class="adm-section-title">
                        <i class="fas fa-users"></i>
                        <h2>GESTIÓN DE USUARIOS</h2>
                    </div>
                    <button id="createUserBtn" class="adm-btn adm-btn-primary">
                        <i class="fas fa-user-plus"></i>
                        <span>Registrar Nuevo Usuario</span>
                    </button>
                </div>
                
                <div class="adm-card">
                    <% if (users && users.length > 0) { %>
                        <div class="adm-table-container">
                            <table class="adm-table">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Username</th>
                                        <th>Email</th>
                                        <th>Summoner</th>
                                        <th>Créditos</th>
                                        <th>Reputación</th>
                                        <th>Fecha Registro</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <% users.forEach(user => { %>
                                        <tr>
                                            <td><%= user.id_summoner %></td>
                                            <td class="adm-table-primary"><%= user.username %></td>
                                            <td><%= user.email %></td>
                                            <td><%= user.summoner %></td>
                                            <td class="adm-table-highlight"><%= user.creditos %></td>
                                            <td>
                                                <div class="adm-reputation">
                                                    <div class="adm-reputation-bar">
                                                        <div class="adm-reputation-fill" style="width: <%= Math.min(100, user.reputation) %>%"></div>
                                                    </div>
                                                    <span><%= user.reputation %></span>
                                                </div>
                                            </td>
                                            <td><%= new Date(user.created_at).toLocaleDateString() %></td>
                                            <td class="adm-table-actions">
                                                <div class="adm-action-buttons">
                                                    <button class="adm-action-btn adm-edit-btn edit-user-btn" 
                                                            data-user-id="<%= user.id_summoner %>" 
                                                            data-username="<%= user.username %>" 
                                                            data-email="<%= user.email %>" 
                                                            data-summoner="<%= user.summoner %>" 
                                                            data-creditos="<%= user.creditos %>"
                                                            data-id-summoner="<%= user.id_summoner %>"
                                                            title="Editar usuario">
                                                        <i class="fas fa-edit"></i>
                                                    </button>
                                                    <% if (user.username !== 'admin') { %>
                                                        <a
                                                            href="/delete-user/<%= encodeURIComponent(user.id_summoner) %>"
                                                            class="adm-action-btn adm-delete-btn"
                                                            onclick="return confirm('¿Estás seguro de que deseas eliminar este usuario? Esta acción no se puede deshacer.')"
                                                            title="Eliminar usuario"
                                                            >
                                                            <i class="fas fa-trash-alt"></i>
                                                        </a>
                                                    <% } %>
                                                </div>
                                            </td>
                                        </tr>
                                    <% }); %>
                                </tbody>
                            </table>
                        </div>
                    <% } else { %>
                        <div class="adm-empty-state">
                            <div class="adm-empty-icon">
                                <i class="fas fa-users"></i>
                            </div>
                            <h3>No hay usuarios registrados</h3>
                            <p>Registra un nuevo usuario para comenzar</p>
                            <button id="createUserBtn2" class="adm-btn adm-btn-primary">
                                <i class="fas fa-user-plus"></i>
                                <span>Registrar Nuevo Usuario</span>
                            </button>
                        </div>
                    <% } %>
                </div>
            </div>
            
            <!-- Matches Section -->
            <div id="matches" class="adm-section" style="display: none;">
                <div class="adm-section-header">
                    <div class="adm-section-title">
                        <i class="fas fa-gamepad"></i>
                        <h2>GESTIÓN DE PARTIDAS</h2>
                    </div>
                    <button class="adm-btn adm-btn-primary">
                        <i class="fas fa-search"></i>
                        <span>Buscar Partida</span>
                    </button>
                </div>
                
                <div class="adm-card">
                    <div class="adm-empty-state">
                        <div class="adm-empty-icon">
                            <i class="fas fa-gamepad"></i>
                        </div>
                        <h3>Sección en desarrollo</h3>
                        <p>Esta funcionalidad estará disponible próximamente</p>
                    </div>
                </div>
            </div>
            
            <!-- Disputes Section -->
            <div id="disputes" class="adm-section" style="display: none;">
                <div class="adm-section-header">
                    <div class="adm-section-title">
                        <i class="fas fa-exclamation-triangle"></i>
                        <h2>DISPUTAS PENDIENTES</h2>
                    </div>
                    <a href="/admin/disputes" class="adm-btn adm-btn-primary">
                        <i class="fas fa-gavel"></i>
                        <span>Ver Todas las Disputas</span>
                    </a>
                </div>
                
                <div class="adm-card">
                    <div class="adm-empty-state">
                        <div class="adm-empty-icon">
                            <i class="fas fa-gavel"></i>
                        </div>
                        <h3>Gestión de disputas</h3>
                        <p>Haz clic en "Ver Todas las Disputas" para gestionar las disputas pendientes</p>
                        <a href="/admin/disputes" class="adm-btn adm-btn-primary">
                            <i class="fas fa-gavel"></i>
                            <span>Ver Todas las Disputas</span>
                        </a>
                    </div>
                </div>
            </div>
            
            <!-- Stats Section -->
            <div id="stats" class="adm-section" style="display: none;">
                <div class="adm-section-header">
                    <div class="adm-section-title">
                        <i class="fas fa-chart-bar"></i>
                        <h2>ESTADÍSTICAS</h2>
                    </div>
                </div>
                
                <div class="adm-card">
                    <div class="adm-empty-state">
                        <div class="adm-empty-icon">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <h3>Sección en desarrollo</h3>
                        <p>Las estadísticas estarán disponibles próximamente</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Create Tournament Modal -->
<div id="createTournamentModal" class="adm-modal">
    <div class="adm-modal-overlay"></div>
    <div class="adm-modal-container">
        <div class="adm-modal-header">
            <div class="adm-modal-title">
                <i class="fas fa-trophy"></i>
                <h3>Crear Nuevo Torneo</h3>
            </div>
            <button class="adm-modal-close" aria-label="Cerrar">
                <i class="fas fa-times"></i>
            </button>
        </div>
        
        <div class="adm-modal-body">
            <form id="createTournamentForm" action="/create-tournament" method="POST" enctype="multipart/form-data" class="adm-form">
                <!-- Basic Information -->
                <div class="adm-form-section">
                    <div class="adm-form-section-header">
                        <i class="fas fa-info-circle"></i>
                        <h4>Información Básica</h4>
                    </div>
                    
                    <div class="adm-form-group">
                        <label for="name" class="adm-form-label">
                            <i class="fas fa-font"></i>
                            Nombre del Torneo
                        </label>
                        <div class="adm-input-wrapper">
                            <input type="text" id="name" name="name" class="adm-form-input" placeholder="Ingresa el nombre del torneo" required>
                            <div class="adm-input-focus-ring"></div>
                        </div>
                    </div>
                    
                    <div class="adm-form-group">
                        <label for="description" class="adm-form-label">
                            <i class="fas fa-align-left"></i>
                            Descripción
                        </label>
                        <div class="adm-textarea-wrapper">
                            <textarea id="description" name="description" class="adm-form-textarea" placeholder="Describe el torneo, reglas, premios, etc." rows="3"></textarea>
                            <div class="adm-textarea-focus-ring"></div>
                        </div>
                    </div>
                    
                    <div class="adm-form-group">
                        <label for="tournament_image" class="adm-form-label">
                            <i class="fas fa-image"></i>
                            Imagen del Torneo
                        </label>
                        <div class="adm-file-upload-area" id="fileUploadArea">
                            <input type="file" id="tournament_image" name="tournament_image" accept="image/*" class="adm-file-input">
                            <div class="adm-file-upload-content">
                                <div class="adm-file-upload-icon">
                                    <i class="fas fa-cloud-upload-alt"></i>
                                </div>
                                <div class="adm-file-upload-text">
                                    <span class="adm-file-upload-main">Arrastra tu imagen aquí o haz clic para seleccionar</span>
                                    <span class="adm-file-upload-sub">PNG, JPG, GIF hasta 5MB</span>
                                </div>
                            </div>
                            <div class="adm-file-preview" id="filePreview" style="display: none;">
                                <img id="previewImage" src="/placeholder.svg" alt="Preview">
                                <div class="adm-file-info">
                                    <span id="fileName"></span>
                                    <button type="button" class="adm-file-remove" id="removeFile">
                                        <i class="fas fa-times"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Tournament Details -->
                <div class="adm-form-section">
                    <div class="adm-form-section-header">
                        <i class="fas fa-cog"></i>
                        <h4>Detalles del Torneo</h4>
                    </div>
                    
                    <div class="adm-form-row">
                        <div class="adm-form-group">
                            <label for="start_date" class="adm-form-label">
                                <i class="fas fa-calendar"></i>
                                Fecha de Inicio
                            </label>
                            <div class="adm-input-wrapper">
                                <input type="date" id="start_date" name="start_date" class="adm-form-input" required>
                                <div class="adm-input-focus-ring"></div>
                            </div>
                        </div>
                        
                        <div class="adm-form-group">
                            <label for="start_time" class="adm-form-label">
                                <i class="fas fa-clock"></i>
                                Hora de Inicio
                            </label>
                            <div class="adm-input-wrapper">
                                <input type="time" id="start_time" name="start_time" class="adm-form-input" required>
                                <div class="adm-input-focus-ring"></div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="adm-form-row">
                        <div class="adm-form-group">
                            <label for="entry_fee" class="adm-form-label">
                                <i class="fas fa-ticket-alt"></i>
                                Costo de Entrada
                            </label>
                            <div class="adm-input-wrapper">
                                <input type="number" id="entry_fee" name="entry_fee" min="0" step="0.01" value="5" class="adm-form-input">
                                <div class="adm-input-focus-ring"></div>
                                <div class="adm-input-suffix">Créditos</div>
                            </div>
                        </div>
                        
                        <div class="adm-form-group">
                            <label for="prize_pool" class="adm-form-label">
                                <i class="fas fa-trophy"></i>
                                Premio Total
                            </label>
                            <div class="adm-input-wrapper">
                                <input type="number" id="prize_pool" name="prize_pool" min="0" step="0.01" value="100" class="adm-form-input">
                                <div class="adm-input-focus-ring"></div>
                                <div class="adm-input-suffix">Créditos</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="adm-form-row">
                        <div class="adm-form-group">
                            <label for="team_size" class="adm-form-label">
                                <i class="fas fa-users"></i>
                                Tamaño de Equipo
                            </label>
                            <div class="adm-select-wrapper">
                                <select id="team_size" name="team_size" class="adm-form-select">
                                    <option value="1vs1" selected>1vs1</option>
                                    <option value="2vs2">2vs2</option>
                                    <option value="3vs3">3vs3</option>
                                    <option value="5vs5">5vs5</option>
                                </select>
                                <div class="adm-select-arrow">
                                    <i class="fas fa-chevron-down"></i>
                                </div>
                                <div class="adm-select-focus-ring"></div>
                            </div>
                        </div>
                        
                        <div class="adm-form-group">
                            <label for="format" class="adm-form-label">
                                <i class="fas fa-sitemap"></i>
                                Formato
                            </label>
                            <div class="adm-select-wrapper">
                                <select id="format" name="format" class="adm-form-select">
                                    <option value="Eliminación Simple" selected>Eliminación Simple</option>
                                    <option value="Eliminación Doble">Eliminación Doble</option>
                                    <option value="Grupos + Eliminación">Grupos + Eliminación</option>
                                    <option value="Round Robin">Round Robin</option>
                                </select>
                                <div class="adm-select-arrow">
                                    <i class="fas fa-chevron-down"></i>
                                </div>
                                <div class="adm-select-focus-ring"></div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="adm-form-row">
                        <div class="adm-form-group">
                            <label for="map" class="adm-form-label">
                                <i class="fas fa-map"></i>
                                Mapa
                            </label>
                            <div class="adm-select-wrapper">
                                <select id="map" name="map" class="adm-form-select">
                                    <option value="Grieta del Invocador" selected>Grieta del Invocador</option>
                                    <option value="ARAM">ARAM</option>
                                    <option value="TFT">TFT</option>
                                </select>
                                <div class="adm-select-arrow">
                                    <i class="fas fa-chevron-down"></i>
                                </div>
                                <div class="adm-select-focus-ring"></div>
                            </div>
                        </div>
                        
                        <div class="adm-form-group">
                            <label for="region" class="adm-form-label">
                                <i class="fas fa-globe"></i>
                                Región
                            </label>
                            <div class="adm-select-wrapper">
                                <select id="region" name="region" class="adm-form-select">
                                    <option value="euw">EUW</option>
                                    <option value="eune">EUNE</option>
                                    <option value="na" selected>NA</option>
                                    <option value="kr">KR</option>
                                    <option value="japan">Japan</option>
                                    <option value="br">BR</option>
                                    <option value="lan">LAN</option>
                                    <option value="las">LAS</option>
                                    <option value="oce">OCE</option>
                                    <option value="ru">RU</option>
                                    <option value="tr">TR</option>
                                </select>
                                <div class="adm-select-arrow">
                                    <i class="fas fa-chevron-down"></i>
                                </div>
                                <div class="adm-select-focus-ring"></div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="adm-form-row">
                        <div class="adm-form-group">
                            <label for="skill_level" class="adm-form-label">
                                <i class="fas fa-star"></i>
                                Nivel de Habilidad
                            </label>
                            <div class="adm-select-wrapper">
                                <select id="skill_level" name="skill_level" class="adm-form-select">
                                    <option value="All" selected>Todos</option>
                                    <option value="Unranked">Sin Clasificar</option>
                                    <option value="Iron-Gold">Hierro-Oro</option>
                                    <option value="Platinum+">Platino+</option>
                                    <option value="Diamond+">Diamante+</option>
                                </select>
                                <div class="adm-select-arrow">
                                    <i class="fas fa-chevron-down"></i>
                                </div>
                                <div class="adm-select-focus-ring"></div>
                            </div>
                        </div>
                        
                        <div class="adm-form-group">
                            <label for="max_participants" class="adm-form-label">
                                <i class="fas fa-users-cog"></i>
                                Máximo de Participantes
                            </label>
                            <div class="adm-select-wrapper">
                                <select id="max_participants" name="max_participants" class="adm-form-select">
                                    <option value="8">8</option>
                                    <option value="16" selected>16</option>
                                    <option value="32">32</option>
                                    <option value="64">64</option>
                                </select>
                                <div class="adm-select-arrow">
                                    <i class="fas fa-chevron-down"></i>
                                </div>
                                <div class="adm-select-focus-ring"></div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Form Actions -->
                <div class="adm-form-actions">
                    <button type="button" class="adm-btn adm-btn-outline adm-close-modal">
                        <i class="fas fa-times"></i>
                        <span>Cancelar</span>
                    </button>
                    <button type="submit" class="adm-btn adm-btn-primary">
                        <i class="fas fa-check"></i>
                        <span>Crear Torneo</span>
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Create User Modal -->
<div id="createUserModal" class="adm-modal">
    <div class="adm-modal-overlay"></div>
    <div class="adm-modal-container">
        <div class="adm-modal-header">
            <div class="adm-modal-title">
                <i class="fas fa-user-plus"></i>
                <h3>Registrar Nuevo Usuario</h3>
            </div>
            <button class="adm-modal-close" id="closeUserModal" aria-label="Cerrar">
                <i class="fas fa-times"></i>
            </button>
        </div>
        
        <div class="adm-modal-body">
            <form id="createUserForm" action="/admin-create-user" method="POST" class="adm-form">
                <div class="adm-form-section">
                    <div class="adm-form-section-header">
                        <i class="fas fa-user"></i>
                        <h4>Información del Usuario</h4>
                    </div>
                    
                    <div class="adm-form-group">
                        <label for="user_id_summoner" class="adm-form-label">
                            <i class="fas fa-id-card"></i>
                            ID Summoner
                        </label>
                        <div class="adm-input-wrapper">
                            <input type="text" id="user_id_summoner" name="id_summoner" class="adm-form-input" 
                                   placeholder="ejemplo: player#euw" 
                                   pattern="^[a-zA-Z0-9]+#[a-zA-Z0-9]+$"
                                   title="Formato requerido: nombre#región (ej: player#euw)" required>
                            <div class="adm-input-focus-ring"></div>
                        </div>
                        <small class="adm-form-help">
                            <i class="fas fa-info-circle"></i>
                            Formato: nombre#región (ejemplo: player#euw)
                        </small>
                    </div>
                    
                    <div class="adm-form-row">
                        <div class="adm-form-group">
                            <label for="user_username" class="adm-form-label">
                                <i class="fas fa-user"></i>
                                Nombre de Usuario
                            </label>
                            <div class="adm-input-wrapper">
                                <input type="text" id="user_username" name="username" class="adm-form-input" placeholder="Nombre de usuario" required>
                                <div class="adm-input-focus-ring"></div>
                            </div>
                        </div>
                        
                        <div class="adm-form-group">
                            <label for="user_email" class="adm-form-label">
                                <i class="fas fa-envelope"></i>
                                Email
                            </label>
                            <div class="adm-input-wrapper">
                                <input type="email" id="user_email" name="email" class="adm-form-input" placeholder="correo@ejemplo.com" required>
                                <div class="adm-input-focus-ring"></div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="adm-form-row">
                        <div class="adm-form-group">
                            <label for="user_password" class="adm-form-label">
                                <i class="fas fa-lock"></i>
                                Contraseña
                            </label>
                            <div class="adm-input-wrapper">
                                <input type="password" id="user_password" name="password" class="adm-form-input" placeholder="Contraseña" required minlength="6">
                                <button type="button" class="adm-password-toggle" onclick="togglePassword('user_password')">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <div class="adm-input-focus-ring"></div>
                            </div>
                            <small class="adm-form-help">
                                <i class="fas fa-info-circle"></i>
                                Mínimo 6 caracteres
                            </small>
                        </div>
                        
                        <div class="adm-form-group">
                            <label for="user_summoner" class="adm-form-label">
                                <i class="fas fa-gamepad"></i>
                                Nombre de Invocador
                            </label>
                            <div class="adm-input-wrapper">
                                <input type="text" id="user_summoner" name="summoner" class="adm-form-input" placeholder="Nombre en el juego" required>
                                <div class="adm-input-focus-ring"></div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="adm-form-group">
                        <label for="user_creditos" class="adm-form-label">
                            <i class="fas fa-coins"></i>
                            Créditos Iniciales
                        </label>
                        <div class="adm-input-wrapper">
                            <input type="number" id="user_creditos" name="creditos" min="0" value="100" class="adm-form-input">
                            <div class="adm-input-focus-ring"></div>
                            <div class="adm-input-suffix">Créditos</div>
                        </div>
                    </div>
                </div>
                
                <!-- Form Actions -->
                <div class="adm-form-actions">
                    <button type="button" class="adm-btn adm-btn-outline adm-close-user-modal">
                        <i class="fas fa-times"></i>
                        <span>Cancelar</span>
                    </button>
                    <button type="submit" class="adm-btn adm-btn-primary">
                        <i class="fas fa-user-plus"></i>
                        <span>Crear Usuario</span>
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Edit User Modal -->
<div id="editUserModal" class="adm-modal">
    <div class="adm-modal-overlay"></div>
    <div class="adm-modal-container">
        <div class="adm-modal-header">
            <div class="adm-modal-title">
                <i class="fas fa-user-edit"></i>
                <h3>Editar Usuario</h3>
            </div>
            <button class="adm-modal-close" id="closeEditUserModal" aria-label="Cerrar">
                <i class="fas fa-times"></i>
            </button>
        </div>
        
        <div class="adm-modal-body">
            <form id="editUserForm" action="/admin-edit-user" method="POST" class="adm-form">
                <input type="hidden" id="edit_user_id" name="user_id">
                
                <div class="adm-form-section">
                    <div class="adm-form-section-header">
                        <i class="fas fa-user"></i>
                        <h4>Información del Usuario</h4>
                    </div>
                    
                    <div class="adm-form-group">
                        <label for="edit_user_id_summoner" class="adm-form-label">
                            <i class="fas fa-id-card"></i>
                            ID Summoner
                        </label>
                        <div class="adm-input-wrapper">
                            <input type="text" id="edit_user_id_summoner" name="id_summoner" class="adm-form-input" 
                                   placeholder="ejemplo: player#euw" 
                                   pattern="^[a-zA-Z0-9]+#[a-zA-Z0-9]+$"
                                   title="Formato requerido: nombre#región (ej: player#euw)" required>
                            <div class="adm-input-focus-ring"></div>
                        </div>
                        <small class="adm-form-help">
                            <i class="fas fa-info-circle"></i>
                            Formato: nombre#región (ejemplo: player#euw)
                        </small>
                    </div>
                    
                    <div class="adm-form-row">
                        <div class="adm-form-group">
                            <label for="edit_user_username" class="adm-form-label">
                                <i class="fas fa-user"></i>
                                Nombre de Usuario
                            </label>
                            <div class="adm-input-wrapper">
                                <input type="text" id="edit_user_username" name="username" class="adm-form-input" placeholder="Nombre de usuario" required>
                                <div class="adm-input-focus-ring"></div>
                            </div>
                        </div>
                        
                        <div class="adm-form-group">
                            <label for="edit_user_email" class="adm-form-label">
                                <i class="fas fa-envelope"></i>
                                Email
                            </label>
                            <div class="adm-input-wrapper">
                                <input type="email" id="edit_user_email" name="email" class="adm-form-input" placeholder="correo@ejemplo.com" required>
                                <div class="adm-input-focus-ring"></div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="adm-form-row">
                        <div class="adm-form-group">
                            <label for="edit_user_summoner" class="adm-form-label">
                                <i class="fas fa-gamepad"></i>
                                Nombre de Invocador
                            </label>
                            <div class="adm-input-wrapper">
                                <input type="text" id="edit_user_summoner" name="summoner" class="adm-form-input" placeholder="Nombre en el juego" required>
                                <div class="adm-input-focus-ring"></div>
                            </div>
                        </div>
                        
                        <div class="adm-form-group">
                            <label for="edit_user_creditos" class="adm-form-label">
                                <i class="fas fa-coins"></i>
                                Créditos
                            </label>
                            <div class="adm-input-wrapper">
                                <input type="number" id="edit_user_creditos" name="creditos" min="0" class="adm-form-input">
                                <div class="adm-input-focus-ring"></div>
                                <div class="adm-input-suffix">Créditos</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="adm-form-group">
                        <label for="edit_user_password" class="adm-form-label">
                            <i class="fas fa-lock"></i>
                            Nueva Contraseña (opcional)
                        </label>
                        <div class="adm-input-wrapper">
                            <input type="password" id="edit_user_password" name="password" class="adm-form-input" placeholder="Dejar en blanco para mantener la actual" minlength="6">
                            <button type="button" class="adm-password-toggle" onclick="togglePassword('edit_user_password')">
                                <i class="fas fa-eye"></i>
                            </button>
                            <div class="adm-input-focus-ring"></div>
                        </div>
                        <small class="adm-form-help">
                            <i class="fas fa-info-circle"></i>
                            Deja en blanco para mantener la contraseña actual
                        </small>
                    </div>
                </div>
                
                <!-- Form Actions -->
                <div class="adm-form-actions">
                    <button type="button" class="adm-btn adm-btn-outline adm-close-edit-user-modal">
                        <i class="fas fa-times"></i>
                        <span>Cancelar</span>
                    </button>
                    <button type="submit" class="adm-btn adm-btn-primary">
                        <i class="fas fa-save"></i>
                        <span>Actualizar Usuario</span>
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Navigation between sections
    const navItems = document.querySelectorAll('.adm-nav-item');
    const sections = document.querySelectorAll('.adm-section');
    
    navItems.forEach(item => {
        item.addEventListener('click', function(e) {
            e.preventDefault();
            
            // Remove active class from all items
            navItems.forEach(i => i.classList.remove('adm-nav-active'));
            
            // Add active class to clicked item
            this.classList.add('adm-nav-active');
            
            // Hide all sections
            sections.forEach(section => {
                section.style.display = 'none';
            });
            
            // Show target section
            const targetId = this.getAttribute('href').substring(1);
            const targetSection = document.getElementById(targetId);
            if (targetSection) {
                targetSection.style.display = 'block';
            }
        });
    });
    
    // Modal functionality
    const modals = {
        tournament: {
            modal: document.getElementById('createTournamentModal'),
            triggers: ['createTournamentBtn', 'createTournamentBtn2', 'createTournamentBtn3'],
            closeButtons: ['.adm-modal-close', '.adm-close-modal']
        },
        user: {
            modal: document.getElementById('createUserModal'),
            triggers: ['createUserBtn', 'createUserBtn2'],
            closeButtons: ['#closeUserModal', '.adm-close-user-modal']
        },
        editUser: {
            modal: document.getElementById('editUserModal'),
            triggers: [],
            closeButtons: ['#closeEditUserModal', '.adm-close-edit-user-modal']
        }
    };
    
    // Setup modal triggers and close buttons
    Object.values(modals).forEach(modalConfig => {
        if (!modalConfig.modal) return;
        
        // Setup triggers
        modalConfig.triggers.forEach(triggerId => {
            const trigger = document.getElementById(triggerId);
            if (trigger) {
                trigger.addEventListener('click', () => openModal(modalConfig.modal));
            }
        });
        
        // Setup close buttons
        modalConfig.closeButtons.forEach(selector => {
            const closeBtn = document.querySelector(selector);
            if (closeBtn) {
                closeBtn.addEventListener('click', () => closeModal(modalConfig.modal));
            }
        });
        
        // Close on overlay click
        modalConfig.modal.addEventListener('click', function(e) {
            if (e.target === this || e.target.classList.contains('adm-modal-overlay')) {
                closeModal(this);
            }
        });
    });
    
    function openModal(modal) {
        modal.style.display = 'block';
        document.body.style.overflow = 'hidden';
        
        // Set default values for tournament modal
        if (modal.id === 'createTournamentModal') {
            const today = new Date();
            const formattedDate = today.toISOString().split('T')[0];
            document.getElementById('start_date').value = formattedDate;
            
            const hours = today.getHours() + 2;
            const minutes = today.getMinutes();
            const formattedTime = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}`;
            document.getElementById('start_time').value = formattedTime;
        }
    }
    
    function closeModal(modal) {
        modal.style.display = 'none';
        document.body.style.overflow = '';
    }
    
    // Edit user functionality
    const editUserBtns = document.querySelectorAll('.edit-user-btn');
    editUserBtns.forEach(btn => {
        btn.addEventListener('click', function() {
            const userId = this.getAttribute('data-user-id');
            const username = this.getAttribute('data-username');
            const email = this.getAttribute('data-email');
            const summoner = this.getAttribute('data-summoner');
            const creditos = this.getAttribute('data-creditos');
            const idSummoner = this.getAttribute('data-id-summoner');
            
            document.getElementById('edit_user_id').value = userId;
            document.getElementById('edit_user_username').value = username;
            document.getElementById('edit_user_email').value = email;
            document.getElementById('edit_user_summoner').value = summoner;
            document.getElementById('edit_user_creditos').value = creditos;
            document.getElementById('edit_user_id_summoner').value = idSummoner;
            document.getElementById('edit_user_password').value = '';
            
            openModal(modals.editUser.modal);
        });
    });
    
    // Password toggle functionality
    window.togglePassword = function(inputId) {
        const input = document.getElementById(inputId);
        const button = input.nextElementSibling;
        const icon = button.querySelector('i');
        
        if (input.type === 'password') {
            input.type = 'text';
            icon.classList.remove('fa-eye');
            icon.classList.add('fa-eye-slash');
        } else {
            input.type = 'password';
            icon.classList.remove('fa-eye-slash');
            icon.classList.add('fa-eye');
        }
    };
    
    // File upload functionality
    const fileUploadArea = document.getElementById('fileUploadArea');
    const fileInput = document.getElementById('tournament_image');
    const filePreview = document.getElementById('filePreview');
    const previewImage = document.getElementById('previewImage');
    const fileName = document.getElementById('fileName');
    const removeFileBtn = document.getElementById('removeFile');
    
    if (fileUploadArea && fileInput) {
        // Drag and drop
        fileUploadArea.addEventListener('dragover', function(e) {
            e.preventDefault();
            this.classList.add('adm-dragover');
        });
        
        fileUploadArea.addEventListener('dragleave', function(e) {
            e.preventDefault();
            this.classList.remove('adm-dragover');
        });
        
        fileUploadArea.addEventListener('drop', function(e) {
            e.preventDefault();
            this.classList.remove('adm-dragover');
            
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                handleFileSelect(files[0]);
            }
        });
        
        // File input change
        fileInput.addEventListener('change', function() {
            if (this.files.length > 0) {
                handleFileSelect(this.files[0]);
            }
        });
        
        // Remove file
        if (removeFileBtn) {
            removeFileBtn.addEventListener('click', function() {
                fileInput.value = '';
                filePreview.style.display = 'none';
                document.querySelector('.adm-file-upload-content').style.display = 'block';
            });
        }
    }
    
    function handleFileSelect(file) {
        // Validate file
        if (!file.type.match('image.*')) {
            alert('Solo se permiten archivos de imagen.');
            return;
        }
        
        if (file.size > 5 * 1024 * 1024) {
            alert('El archivo es demasiado grande. El tamaño máximo es 5MB.');
            return;
        }
        
        // Show preview
        const reader = new FileReader();
        reader.onload = function(e) {
            previewImage.src = e.target.result;
            fileName.textContent = file.name;
            filePreview.style.display = 'flex';
            document.querySelector('.adm-file-upload-content').style.display = 'none';
        };
        reader.readAsDataURL(file);
    }
    
    // Form validation
    const createTournamentForm = document.getElementById('createTournamentForm');
    if (createTournamentForm) {
        createTournamentForm.addEventListener('submit', function(e) {
            const entryFee = parseFloat(document.getElementById('entry_fee').value);
            const prizePool = parseFloat(document.getElementById('prize_pool').value);
            
            if (prizePool < entryFee) {
                e.preventDefault();
                alert('El premio total debe ser mayor o igual al costo de entrada.');
                return;
            }
        });
    }
    
    // Animate elements on load
    const cards = document.querySelectorAll('.adm-card');
    cards.forEach((card, index) => {
        card.style.opacity = '0';
        card.style.transform = 'translateY(20px)';
        
        setTimeout(() => {
            card.style.transition = 'all 0.6s ease';
            card.style.opacity = '1';
            card.style.transform = 'translateY(0)';
        }, index * 200);
    });
    
    // Close alerts
    const alerts = document.querySelectorAll('.adm-alert');
    alerts.forEach(alert => {
        setTimeout(() => {
            alert.style.opacity = '0';
            alert.style.transform = 'translateY(-10px)';
            setTimeout(() => {
                alert.remove();
            }, 300);
        }, 5000);
    });
});
</script>
<script src="/auth.js"></script>

<%- include('partials/footer') %>