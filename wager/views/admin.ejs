<%- include('partials/header', { title: 'Admin Panel', username: username }) %>

<div class="main-content">
    <div class="sidebar">
        <div class="sidebar-section">
            <h3 class="sidebar-title">ADMIN PANEL</h3>
            <div class="admin-menu">
                <a href="#tournaments" class="admin-menu-item active">Torneos</a>
                <a href="#users" class="admin-menu-item">Usuarios</a>
                <a href="#matches" class="admin-menu-item">Partidas</a>
                <a href="#disputes" class="admin-menu-item">Disputas</a>
                <a href="#stats" class="admin-menu-item">Estadísticas</a>
            </div>
        </div>
        <div class="sidebar-section">
            <h3 class="sidebar-title">ACCIONES RÁPIDAS</h3>
            <div class="quick-actions">
                <button id="createTournamentBtn" class="quick-action-btn">Crear Torneo</button>
                <button class="quick-action-btn">Ver Disputas</button>
                <button class="quick-action-btn">Estadísticas</button>
            </div>
        </div>
    </div>
    <div class="content">
        <div class="top-bar">
            <h2 class="page-title">PANEL DE ADMINISTRACIÓN</h2>
            <div class="view-options">
                <a href="/matchfinder" class="nav-link">← Volver a Matchfinder</a>
            </div>
        </div>
        
        <% if (typeof message !== 'undefined' && message) { %>
            <div class="alert alert-success">
                <% if (message === 'tournament-created') { %>
                    Torneo creado correctamente.
                <% } else if (message === 'tournament-deleted') { %>
                    Torneo eliminado correctamente.
                <% } else { %>
                    <%= message %>
                <% } %>
            </div>
        <% } %>
        
        <% if (typeof error !== 'undefined' && error) { %>
            <div class="alert alert-error">
                <% if (error === 'failed-to-create-tournament') { %>
                    Error al crear el torneo.
                <% } else if (error === 'tournament-not-found') { %>
                    Torneo no encontrado.
                <% } else if (error === 'server-error') { %>
                    Error del servidor. Inténtalo de nuevo más tarde.
                <% } else { %>
                    <%= error %>
                <% } %>
            </div>
        <% } %>
        
        <div id="tournaments" class="admin-section">
            <div class="section-header">
                <h3>GESTIÓN DE TORNEOS</h3>
                <button id="createTournamentBtn2" class="btn btn-primary">Crear Nuevo Torneo</button>
            </div>
            
            <div class="tournaments-list">
                <% if (tournaments && tournaments.length > 0) { %>
                    <div class="table-responsive">
                        <table class="admin-table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Nombre</th>
                                    <th>Fecha</th>
                                    <th>Formato</th>
                                    <th>Participantes</th>
                                    <th>Premio</th>
                                    <th>Estado</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody>
                                <% tournaments.forEach(tournament => { %>
                                    <tr>
                                        <td><%= tournament.id_tournament %></td>
                                        <td><%= tournament.name %></td>
                                        <td><%= new Date(tournament.start_date).toLocaleString() %></td>
                                        <td><%= tournament.team_size %> - <%= tournament.format %></td>
                                        <td><%= tournament.current_participants %>/<%= tournament.max_participants %></td>
                                        <td><%= tournament.prize_pool %> Credits</td>
                                        <td><span class="status-badge <%= tournament.status %>"><%= tournament.status %></span></td>
                                        <td class="actions">
                                            <a href="#" class="action-btn view-btn" data-id="<%= tournament.id_tournament %>">Ver</a>
                                            <a href="#" class="action-btn edit-btn" data-id="<%= tournament.id_tournament %>">Editar</a>
                                            <a href="/delete-tournament/<%= tournament.id_tournament %>" class="action-btn delete-btn" onclick="return confirm('¿Estás seguro de que deseas eliminar este torneo?')">Eliminar</a>
                                        </td>
                                    </tr>
                                <% }); %>
                            </tbody>
                        </table>
                    </div>
                <% } else { %>
                    <div class="no-data">
                        <p>No hay torneos creados.</p>
                        <p>Crea un nuevo torneo para comenzar.</p>
                    </div>
                <% } %>
            </div>
        </div>
        
        <div id="users" class="admin-section" style="display: none;">
            <div class="section-header">
                <h3>GESTIÓN DE USUARIOS</h3>
                <button class="btn btn-primary">Buscar Usuario</button>
            </div>
            
            <div class="no-data">
                <p>Sección en desarrollo.</p>
            </div>
        </div>
        
        <div id="matches" class="admin-section" style="display: none;">
            <div class="section-header">
                <h3>GESTIÓN DE PARTIDAS</h3>
                <button class="btn btn-primary">Buscar Partida</button>
            </div>
            
            <div class="no-data">
                <p>Sección en desarrollo.</p>
            </div>
        </div>
        
        <div id="disputes" class="admin-section" style="display: none;">
            <div class="section-header">
                <h3>DISPUTAS PENDIENTES</h3>
            </div>
            
            <div class="no-data">
                <p>Sección en desarrollo.</p>
            </div>
        </div>
        
        <div id="stats" class="admin-section" style="display: none;">
            <div class="section-header">
                <h3>ESTADÍSTICAS</h3>
            </div>
            
            <div class="no-data">
                <p>Sección en desarrollo.</p>
            </div>
        </div>
    </div>
</div>

<!-- Modal para crear torneo -->
<div id="createTournamentModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Crear Nuevo Torneo</h3>
            <span class="close">&times;</span>
        </div>
        <div class="modal-body">
            <form id="createTournamentForm" action="/create-tournament" method="POST" enctype="multipart/form-data">
                <div class="form-section">
                    <h4>Información Básica</h4>
                    <div class="form-group">
                        <label for="name">Nombre del Torneo:</label>
                        <input type="text" id="name" name="name" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="description">Descripción:</label>
                        <textarea id="description" name="description" rows="3"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="tournament_image">Imagen del Torneo:</label>
                        <input type="file" id="tournament_image" name="tournament_image" accept="image/*">
                    </div>
                </div>
                
                <div class="form-section">
                    <h4>Detalles del Torneo</h4>
                    <div class="form-row">
                        <div class="form-group half">
                            <label for="start_date">Fecha de Inicio:</label>
                            <input type="date" id="start_date" name="start_date" required>
                        </div>
                        
                        <div class="form-group half">
                            <label for="start_time">Hora de Inicio:</label>
                            <input type="time" id="start_time" name="start_time" required>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group half">
                            <label for="entry_fee">Costo de Entrada (Créditos):</label>
                            <input type="number" id="entry_fee" name="entry_fee" min="0" step="0.01" value="5">
                        </div>
                        
                        <div class="form-group half">
                            <label for="prize_pool">Premio Total (Créditos):</label>
                            <input type="number" id="prize_pool" name="prize_pool" min="0" step="0.01" value="100">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group half">
                            <label for="team_size">Tamaño de Equipo:</label>
                            <select id="team_size" name="team_size">
                                <option value="1vs1" selected>1vs1</option>
                                <option value="2vs2">2vs2</option>
                                <option value="3vs3">3vs3</option>
                                <option value="5vs5">5vs5</option>
                            </select>
                        </div>
                        
                        <div class="form-group half">
                            <label for="format">Formato:</label>
                            <select id="format" name="format">
                                <option value="Eliminación Simple" selected>Eliminación Simple</option>
                                <option value="Eliminación Doble">Eliminación Doble</option>
                                <option value="Grupos + Eliminación">Grupos + Eliminación</option>
                                <option value="Round Robin">Round Robin</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group half">
                            <label for="map">Mapa:</label>
                            <select id="map" name="map">
                                <option value="Grieta del Invocador" selected>Grieta del Invocador</option>
                                <option value="ARAM">ARAM</option>
                                <option value="TFT">TFT</option>
                            </select>
                        </div>
                        
                        <div class="form-group half">
                            <label for="region">Región:</label>
                            <select id="region" name="region">
                                <option value="euw">EUW</option>
                                <option value="eune">EUNE</option>
                                <option value="na" selected>NA</option>
                                <option value="kr">KR</option>
                                <option value="japan">Japan</option>
                                <option value="br">BR</option>
                                <option value="lan">LAN</option>
                                <option value="las">LAS</option>
                                <option value="oce">OCE</option>
                                <option value="ru">RU</option>
                                <option value="tr">TR</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group half">
                            <label for="skill_level">Nivel de Habilidad:</label>
                            <select id="skill_level" name="skill_level">
                                <option value="All" selected>Todos</option>
                                <option value="Unranked">Sin Clasificar</option>
                                <option value="Iron-Gold">Hierro-Oro</option>
                                <option value="Platinum+">Platino+</option>
                                <option value="Diamond+">Diamante+</option>
                            </select>
                        </div>
                        
                        <div class="form-group half">
                            <label for="max_participants">Máximo de Participantes:</label>
                            <select id="max_participants" name="max_participants">
                                <option value="8">8</option>
                                <option value="16" selected>16</option>
                                <option value="32">32</option>
                                <option value="64">64</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <div class="form-actions">
                    <button type="submit" class="btn btn-primary">Crear Torneo</button>
                    <button type="button" class="btn btn-outline close-modal">Cancelar</button>
                </div>
            </form>
        </div>
    </div>
</div>

<style>
/* Estilos para el panel de administración */
.admin-menu {
    display: flex;
    flex-direction: column;
    gap: 10px;
}

.admin-menu-item {
    padding: 10px 15px;
    border-radius: 4px;
    color: #ccc;
    text-decoration: none;
    transition: background-color 0.2s ease;
}

.admin-menu-item:hover {
    background-color: #2a2a2a;
    color: #fff;
}

.admin-menu-item.active {
    background-color: #8a2be2;
    color: #fff;
}

.quick-actions {
    display: flex;
    flex-direction: column;
    gap: 10px;
}

.quick-action-btn {
    padding: 10px 15px;
    border-radius: 4px;
    background-color: #2a2a2a;
    color: #fff;
    border: none;
    cursor: pointer;
    transition: background-color 0.2s ease;
}

.quick-action-btn:hover {
    background-color: #8a2be2;
}

.admin-section {
    margin-bottom: 30px;
}

.section-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
}

.section-header h3 {
    margin: 0;
    color: #fff;
}

.table-responsive {
    overflow-x: auto;
}

.admin-table {
    width: 100%;
    border-collapse: collapse;
    color: #ccc;
}

.admin-table th, .admin-table td {
    padding: 12px 15px;
    text-align: left;
    border-bottom: 1px solid #333;
}

.admin-table th {
    background-color: #2a2a2a;
    color: #fff;
    font-weight: 600;
}

.admin-table tr:hover {
    background-color: #1e1e1e;
}

.status-badge {
    padding: 5px 10px;
    border-radius: 20px;
    font-size: 0.8rem;
    text-transform: uppercase;
}

.status-badge.upcoming {
    background-color: rgba(0, 100, 255, 0.2);
    color: #0064ff;
}

.status-badge.active {
    background-color: rgba(0, 255, 0, 0.2);
    color: #00ff00;
}

.status-badge.completed {
    background-color: rgba(128, 128, 128, 0.2);
    color: #ccc;
}

.status-badge.cancelled {
    background-color: rgba(255, 0, 0, 0.2);
    color: #ff0000;
}

.actions {
    display: flex;
    gap: 5px;
}

.action-btn {
    padding: 5px 10px;
    border-radius: 4px;
    text-decoration: none;
    font-size: 0.8rem;
}

.view-btn {
    background-color: #2a2a2a;
    color: #ccc;
}

.edit-btn {
    background-color: #0064ff;
    color: #fff;
}

.delete-btn {
    background-color: #ff0000;
    color: #fff;
}

.no-data {
    text-align: center;
    padding: 40px;
    background-color: #1a1a1a;
    border-radius: 8px;
    color: #aaa;
}

.no-data p {
    margin: 5px 0;
}

.no-data p:first-child {
    font-size: 1.2rem;
    margin-bottom: 10px;
}

/* Estilos para el modal */
.modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    overflow: auto;
    background-color: rgba(0, 0, 0, 0.7);
}

.modal-content {
    background-color: #1a1a1a;
    margin: 5% auto;
    padding: 0;
    border-radius: 8px;
    width: 80%;
    max-width: 800px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    animation: modalFadeIn 0.3s;
}

@keyframes modalFadeIn {
    from {opacity: 0; transform: translateY(-20px);}
    to {opacity: 1; transform: translateY(0);}
}

.modal-header {
    padding: 15px 20px;
    background-color: #2a2a2a;
    border-top-left-radius: 8px;
    border-top-right-radius: 8px;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.modal-header h3 {
    margin: 0;
    color: #fff;
}

.close {
    color: #aaa;
    font-size: 28px;
    font-weight: bold;
    cursor: pointer;
}

.close:hover {
    color: #fff;
}

.modal-body {
    padding: 20px;
}

.form-section {
    margin-bottom: 25px;
}

.form-section h4 {
    margin-top: 0;
    margin-bottom: 15px;
    color: #ccc;
    border-bottom: 1px solid #333;
    padding-bottom: 10px;
}

.form-row {
    display: flex;
    gap: 20px;
    margin-bottom: 15px;
}

.form-group {
    margin-bottom: 15px;
    width: 100%;
}

.form-group.half {
    width: 50%;
}

.form-group label {
    display: block;
    margin-bottom: 8px;
    color: #ccc;
}

.form-group input[type="text"],
.form-group input[type="number"],
.form-group input[type="date"],
.form-group input[type="time"],
.form-group select,
.form-group textarea {
    width: 100%;
    padding: 10px;
    border-radius: 4px;
    background-color: #2a2a2a;
    border: 1px solid #333;
    color: #fff;
}

.form-group textarea {
    resize: vertical;
}

.form-actions {
    display: flex;
    justify-content: flex-end;
    gap: 10px;
    margin-top: 20px;
}

.btn {
    padding: 10px 20px;
    border-radius: 4px;
    cursor: pointer;
    font-weight: 600;
    border: none;
}

.btn-primary {
    background-color: #8a2be2;
    color: white;
}

.btn-primary:hover {
    background-color: #9b4ddb;
}

.btn-outline {
    background-color: transparent;
    border: 1px solid #8a2be2;
    color: #8a2be2;
}

.btn-outline:hover {
    background-color: rgba(138, 43, 226, 0.1);
}

.alert {
    padding: 15px;
    border-radius: 4px;
    margin-bottom: 20px;
}

.alert-success {
    background-color: rgba(0, 128, 0, 0.2);
    border-left: 4px solid green;
    color: #ccc;
}

.alert-error {
    background-color: rgba(255, 0, 0, 0.2);
    border-left: 4px solid red;
    color: #ccc;
}
</style>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Navegación entre secciones
        const menuItems = document.querySelectorAll('.admin-menu-item');
        const sections = document.querySelectorAll('.admin-section');
        
        menuItems.forEach(item => {
            item.addEventListener('click', function(e) {
                e.preventDefault();
                
                // Remover clase active de todos los items
                menuItems.forEach(i => i.classList.remove('active'));
                
                // Añadir clase active al item clickeado
                this.classList.add('active');
                
                // Ocultar todas las secciones
                sections.forEach(section => {
                    section.style.display = 'none';
                });
                
                // Mostrar la sección correspondiente
                const targetId = this.getAttribute('href').substring(1);
                document.getElementById(targetId).style.display = 'block';
            });
        });
        
        // Modal de crear torneo
        const modal = document.getElementById('createTournamentModal');
        const createBtn = document.getElementById('createTournamentBtn');
        const createBtn2 = document.getElementById('createTournamentBtn2');
        const closeBtn = document.querySelector('.close');
        const closeBtnOutline = document.querySelector('.close-modal');
        
        function openModal() {
            modal.style.display = 'block';
            
            // Establecer fecha por defecto (hoy)
            const today = new Date();
            const formattedDate = today.toISOString().split('T')[0];
            document.getElementById('start_date').value = formattedDate;
            
            // Establecer hora por defecto (ahora + 2 horas)
            const hours = today.getHours() + 2;
            const minutes = today.getMinutes();
            const formattedTime = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}`;
            document.getElementById('start_time').value = formattedTime;
        }
        
        function closeModal() {
            modal.style.display = 'none';
        }
        
        createBtn.addEventListener('click', openModal);
        createBtn2.addEventListener('click', openModal);
        closeBtn.addEventListener('click', closeModal);
        closeBtnOutline.addEventListener('click', closeModal);
        
        // Cerrar modal al hacer clic fuera del contenido
        window.addEventListener('click', function(event) {
            if (event.target == modal) {
                closeModal();
            }
        });
        
        // Validación del formulario
        const form = document.getElementById('createTournamentForm');
        form.addEventListener('submit', function(e) {
            const entryFee = parseFloat(document.getElementById('entry_fee').value);
            const prizePool = parseFloat(document.getElementById('prize_pool').value);
            
            if (prizePool < entryFee) {
                e.preventDefault();
                alert('El premio total debe ser mayor o igual al costo de entrada.');
            }
        });
    });
</script>

<%- include('partials/footer') %>
