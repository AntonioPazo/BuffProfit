<%- include('partials/header', { title: 'Team Details', username: username }) %>

<div class="tds-main-container">
    <!-- Background Effects -->
    <div class="tds-bg-effects">
        <div class="tds-gradient-orb-1"></div>
        <div class="tds-gradient-orb-2"></div>
        <div class="tds-gradient-orb-3"></div>
    </div>
    
    <div class="tds-content-wrapper">
        <!-- Sidebar -->
        <div class="tds-sidebar">
            <!-- Team Info Section -->
            <div class="tds-sidebar-section">
                <div class="tds-section-header">
                    <div class="tds-section-icon">
                        <i class="fas fa-users"></i>
                    </div>
                    <h3 class="tds-section-title">INFORMACIÓN DEL EQUIPO</h3>
                </div>
                
                <div class="tds-team-info-card">
                    <div class="tds-team-logo-container">
                        <% if (team.logo_path) { %>
                            <img src="<%= team.logo_path %>" alt="<%= team.name %>" class="tds-team-logo">
                        <% } else { %>
                            <div class="tds-team-logo-placeholder">
                                <span><%= team.tag %></span>
                            </div>
                        <% } %>
                        <div class="tds-team-logo-overlay">
                            <i class="fas fa-shield-alt"></i>
                        </div>
                    </div>
                    
                    <div class="tds-team-details">
                        <div class="tds-team-name"><%= team.name %></div>
                        <div class="tds-team-tag">[<%= team.tag %>]</div>
                        
                        <div class="tds-team-meta">
                            <div class="tds-meta-item">
                                <i class="fas fa-crown"></i>
                                <span>Creado por: <%= team.creator_username %></span>
                            </div>
                            <div class="tds-meta-item">
                                <i class="fas fa-calendar-alt"></i>
                                <span>Creado el: <%= new Date(team.created_at).toLocaleDateString() %></span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Actions Section -->
            <% if (isTeamCaptain) { %>
                <div class="tds-sidebar-section">
                    <div class="tds-section-header">
                        <div class="tds-section-icon">
                            <i class="fas fa-cog"></i>
                        </div>
                        <h3 class="tds-section-title">ACCIONES DE CAPITÁN</h3>
                    </div>
                    
                    <div class="tds-action-buttons">
                        <button id="tdsInvitePlayerBtn" class="tds-action-btn tds-primary">
                            <i class="fas fa-user-plus"></i>
                            <span>Invitar Jugador</span>
                        </button>
                        <button id="tdsEditTeamBtn" class="tds-action-btn tds-secondary">
                            <i class="fas fa-edit"></i>
                            <span>Editar Equipo</span>
                        </button>
                        <button id="tdsLeaveTeamBtn" class="tds-action-btn tds-danger">
                            <i class="fas fa-trash-alt"></i>
                            <span>Eliminar Equipo</span>
                        </button>
                    </div>
                </div>
            <% } else if (isTeamMember) { %>
                <div class="tds-sidebar-section">
                    <div class="tds-section-header">
                        <div class="tds-section-icon">
                            <i class="fas fa-door-open"></i>
                        </div>
                        <h3 class="tds-section-title">ACCIONES</h3>
                    </div>
                    
                    <div class="tds-action-buttons">
                        <button id="tdsLeaveTeamBtn" class="tds-action-btn tds-danger">
                            <i class="fas fa-sign-out-alt"></i>
                            <span>Abandonar Equipo</span>
                        </button>
                    </div>
                </div>
            <% } %>
            
            <!-- Notifications Section -->
            <% if (notificationCount > 0) { %>
                <div class="tds-sidebar-section">
                    <div class="tds-section-header">
                        <div class="tds-section-icon">
                            <i class="fas fa-bell"></i>
                        </div>
                        <h3 class="tds-section-title">NOTIFICACIONES</h3>
                    </div>
                    
                    <div class="tds-notification-card">
                        <a href="/notifications" class="tds-notification-link">
                            <div class="tds-notification-icon">
                                <i class="fas fa-bell"></i>
                                <span class="tds-notification-badge"><%= notificationCount %></span>
                            </div>
                            <div class="tds-notification-text">
                                Tienes <%= notificationCount %> notificaciones nuevas
                            </div>
                        </a>
                    </div>
                </div>
            <% } %>
        </div>
        
        <!-- Main Content -->
        <div class="tds-main-content">
            <!-- Header Navigation -->
            <div class="tds-top-navigation">
                <div class="tds-nav-content">
                    <h1 class="tds-page-title"><%= team.name %> [<%= team.tag %>]</h1>
                    <a href="/tournament" class="tds-back-link">
                        <i class="fas fa-arrow-left"></i>
                        <span>Volver a Torneos</span>
                    </a>
                </div>
            </div>
            
            <!-- Alerts -->
            <% if (message) { %>
                <div class="tds-alert tds-alert-success">
                    <div class="tds-alert-icon">
                        <i class="fas fa-check-circle"></i>
                    </div>
                    <div class="tds-alert-content">
                        <% if (message === 'player-invited') { %>
                            <strong>¡Éxito!</strong> Jugador invitado correctamente al equipo.
                        <% } else if (message === 'member-removed') { %>
                            <strong>¡Éxito!</strong> Miembro eliminado correctamente del equipo.
                        <% } else if (message === 'invitation-sent') { %>
                            <strong>¡Invitación enviada!</strong> El jugador recibirá una notificación.
                        <% } else if (message === 'invitation-canceled') { %>
                            <strong>¡Invitación cancelada!</strong> La invitación ha sido cancelada correctamente.
                        <% } else { %>
                            <%= message %>
                        <% } %>
                    </div>
                </div>
            <% } %>
            
            <% if (error) { %>
                <div class="tds-alert tds-alert-error">
                    <div class="tds-alert-icon">
                        <i class="fas fa-exclamation-triangle"></i>
                    </div>
                    <div class="tds-alert-content">
                        <% if (error === 'not-team-captain') { %>
                            <strong>Error:</strong> Solo el capitán del equipo puede realizar esta acción.
                        <% } else if (error === 'player-not-found') { %>
                            <strong>Error:</strong> El jugador no existe en la plataforma.
                        <% } else if (error === 'player-already-in-team') { %>
                            <strong>Error:</strong> Este jugador ya es miembro del equipo.
                        <% } else if (error === 'role-already-taken') { %>
                            <strong>Error:</strong> Este rol ya está ocupado por otro miembro del equipo.
                        <% } else if (error === 'cannot-remove-captain') { %>
                            <strong>Error:</strong> No puedes eliminar al capitán del equipo.
                        <% } else if (error === 'captain-cannot-leave') { %>
                            <strong>Error:</strong> El capitán no puede abandonar el equipo. Debes eliminarlo.
                        <% } else if (error === 'team-in-tournament') { %>
                            <strong>Error:</strong> No puedes eliminar un equipo que está inscrito en un torneo.
                        <% } else if (error === 'invitation-already-sent') { %>
                            <strong>Error:</strong> Ya existe una invitación pendiente para este jugador.
                        <% } else if (error === 'invitation-not-found') { %>
                            <strong>Error:</strong> La invitación no existe o ya no está disponible.
                        <% } else { %>
                            <strong>Error:</strong> <%= error %>
                        <% } %>
                    </div>
                </div>
            <% } %>
            
            <!-- Content Sections -->
            <div class="tds-content-sections">
                <!-- Team Description -->
                <div class="tds-content-section">
                    <div class="tds-section-card">
                        <div class="tds-card-header">
                            <div class="tds-card-icon">
                                <i class="fas fa-align-left"></i>
                            </div>
                            <h3>Descripción del Equipo</h3>
                        </div>
                        <div class="tds-card-content">
                            <p class="tds-team-description">
                                <%= team.description || 'Este equipo no tiene descripción.' %>
                            </p>
                        </div>
                    </div>
                </div>
                
                <!-- Pending Invitations -->
                <% if (isTeamCaptain && pendingInvitations && pendingInvitations.length > 0) { %>
                    <div class="tds-content-section">
                        <div class="tds-section-card">
                            <div class="tds-card-header">
                                <div class="tds-card-icon">
                                    <i class="fas fa-clock"></i>
                                </div>
                                <h3>Invitaciones Pendientes (<%= pendingInvitations.length %>)</h3>
                            </div>
                            <div class="tds-card-content">
                                <div class="tds-invitations-grid">
                                    <% pendingInvitations.forEach(invitation => { %>
                                        <div class="tds-invitation-card">
                                            <div class="tds-invitation-header">
                                                <div class="tds-invitation-avatar">
                                                    <i class="fas fa-user"></i>
                                                </div>
                                                <div class="tds-invitation-info">
                                                    <div class="tds-invitation-player"><%= invitation.invited_username %></div>
                                                    <div class="tds-invitation-role">Rol: <%= invitation.role %></div>
                                                </div>
                                            </div>
                                            
                                            <div class="tds-invitation-meta">
                                                <div class="tds-invitation-date">
                                                    <i class="fas fa-calendar"></i>
                                                    <span>Enviada: <%= new Date(invitation.invitation_date).toLocaleDateString() %></span>
                                                </div>
                                            </div>
                                            
                                            <div class="tds-invitation-actions">
                                                <form action="/cancel-invitation" method="POST" class="tds-inline-form">
                                                    <input type="hidden" name="invitation_id" value="<%= invitation.id_invitation %>">
                                                    <input type="hidden" name="team_id" value="<%= team.id_team %>">
                                                    <button type="submit" class="tds-btn tds-btn-danger-outline" 
                                                            onclick="return confirm('¿Estás seguro de que deseas cancelar esta invitación?')">
                                                        <i class="fas fa-times"></i>
                                                        <span>Cancelar</span>
                                                    </button>
                                                </form>
                                            </div>
                                        </div>
                                    <% }); %>
                                </div>
                            </div>
                        </div>
                    </div>
                <% } %>
                
                <!-- Team Members -->
                <div class="tds-content-section">
                    <div class="tds-section-card">
                        <div class="tds-card-header">
                            <div class="tds-card-icon">
                                <i class="fas fa-users"></i>
                            </div>
                            <h3>Miembros del Equipo (<%= members.length %>)</h3>
                        </div>
                        <div class="tds-card-content">
                            <div class="tds-members-grid">
                                <% members.forEach(member => { %>
                                    <div class="tds-member-card">
                                        <div class="tds-member-header">
                                            <div class="tds-member-avatar">
                                                <i class="fas fa-user"></i>
                                            </div>
                                            <div class="tds-member-info">
                                                <div class="tds-member-name"><%= member.username %></div>
                                                <div class="tds-member-role"><%= member.role || 'Miembro' %></div>
                                            </div>
                                            <% if (member.is_captain) { %>
                                                <div class="tds-captain-badge">
                                                    <i class="fas fa-crown"></i>
                                                    <span>Capitán</span>
                                                </div>
                                            <% } %>
                                        </div>
                                        
                                        <div class="tds-member-stats">
                                            <div class="tds-stat-item">
                                                <i class="fas fa-thumbs-up"></i>
                                                <span>Reputación: <%= member.reputation %></span>
                                            </div>
                                            <div class="tds-stat-item">
                                                <i class="fas fa-calendar-plus"></i>
                                                <span>Unido: <%= new Date(member.joined_at).toLocaleDateString() %></span>
                                            </div>
                                        </div>
                                        
                                        <% if (!member.is_captain && isTeamCaptain) { %>
                                            <div class="tds-member-actions">
                                                <form action="/remove-team-member" method="POST" class="tds-inline-form">
                                                    <input type="hidden" name="team_id" value="<%= team.id_team %>">
                                                    <input type="hidden" name="member_id" value="<%= member.id_summoner %>">
                                                    <button type="submit" class="tds-btn tds-btn-danger-outline tds-btn-sm" 
                                                            onclick="return confirm('¿Estás seguro de que deseas eliminar a este miembro?')">
                                                        <i class="fas fa-user-minus"></i>
                                                        <span>Eliminar</span>
                                                    </button>
                                                </form>
                                            </div>
                                        <% } %>
                                    </div>
                                <% }); %>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Team Tournaments -->
                <div class="tds-content-section">
                    <div class="tds-section-card">
                        <div class="tds-card-header">
                            <div class="tds-card-icon">
                                <i class="fas fa-trophy"></i>
                            </div>
                            <h3>Torneos del Equipo (<%= tournaments.length %>)</h3>
                        </div>
                        <div class="tds-card-content">
                            <% if (tournaments.length > 0) { %>
                                <div class="tds-tournaments-grid">
                                    <% tournaments.forEach(tournament => { %>
                                        <div class="tds-tournament-card">
                                            <div class="tds-tournament-header">
                                                <div class="tds-tournament-image">
                                                    <% if (tournament.image_path) { %>
                                                        <img src="<%= tournament.image_path %>" alt="<%= tournament.name %>">
                                                    <% } else { %>
                                                        <img src="/images/league_of_legends-icon.png" alt="Tournament">
                                                    <% } %>
                                                </div>
                                                <div class="tds-tournament-info">
                                                    <div class="tds-tournament-name"><%= tournament.name %></div>
                                                    <div class="tds-tournament-format"><%= tournament.team_size %> - <%= tournament.format %></div>
                                                </div>
                                            </div>
                                            
                                            <div class="tds-tournament-details">
                                                <div class="tds-tournament-detail">
                                                    <i class="fas fa-calendar"></i>
                                                    <span><%= new Date(tournament.start_date).toLocaleDateString() %></span>
                                                </div>
                                                <div class="tds-tournament-detail">
                                                    <i class="fas fa-coins"></i>
                                                    <span><%= tournament.prize_pool %> Créditos</span>
                                                </div>
                                            </div>
                                            
                                            <div class="tds-tournament-actions">
                                                <a href="/tournament/<%= tournament.id_tournament %>" class="tds-btn tds-btn-primary tds-btn-sm">
                                                    <i class="fas fa-eye"></i>
                                                    <span>Ver Torneo</span>
                                                </a>
                                            </div>
                                        </div>
                                    <% }); %>
                                </div>
                            <% } else { %>
                                <div class="tds-empty-state">
                                    <div class="tds-empty-icon">
                                        <i class="fas fa-trophy"></i>
                                    </div>
                                    <h4>No hay torneos</h4>
                                    <p>Este equipo no está inscrito en ningún torneo.</p>
                                    <a href="/tournament" class="tds-btn tds-btn-primary">
                                        <i class="fas fa-search"></i>
                                        <span>Ver Torneos Disponibles</span>
                                    </a>
                                </div>
                            <% } %>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Invite Player Modal -->
<div id="tdsInvitePlayerModal" class="tds-modal">
    <div class="tds-modal-overlay"></div>
    <div class="tds-modal-container">
        <div class="tds-modal-header">
            <div class="tds-modal-title">
                <i class="fas fa-user-plus"></i>
                <h3>Invitar Jugador</h3>
            </div>
            <button class="tds-modal-close">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="tds-modal-body">
            <form id="tdsInvitePlayerForm" action="/invite-player" method="POST" class="tds-form">
                <input type="hidden" name="team_id" value="<%= team.id_team %>">
                
                <div class="tds-form-group">
                    <label for="tdsPlayerUsername" class="tds-form-label">
                        <i class="fas fa-user"></i>
                        Nombre de Usuario
                    </label>
                    <div class="tds-input-wrapper">
                        <input type="text" id="tdsPlayerUsername" name="player_username" class="tds-form-input" 
                               placeholder="Ingresa el nombre de usuario" required>
                        <div class="tds-input-focus-ring"></div>
                    </div>
                </div>
                
                <div class="tds-form-group">
                    <label for="tdsPlayerRole" class="tds-form-label">
                        <i class="fas fa-chess"></i>
                        Rol en el Equipo
                    </label>
                    <div class="tds-select-wrapper">
                        <select id="tdsPlayerRole" name="player_role" class="tds-form-select" required>
                            <option value="" disabled selected>Selecciona un rol</option>
                            <% 
                                const roles = ['Top', 'Jungle', 'Mid', 'ADC', 'Support'];
                                const occupiedRoles = members.map(member => member.role);
                                
                                roles.forEach(role => {
                                    if (!occupiedRoles.includes(role)) {
                            %>
                                <option value="<%= role %>"><%= role %></option>
                            <% 
                                    } else {
                                        const memberWithRole = members.find(m => m.role === role);
                                        const memberName = memberWithRole ? memberWithRole.username : '';
                                        const isCaptain = memberWithRole && memberWithRole.is_captain;
                                        const roleLabel = isCaptain ? `${role} (Capitán - ${memberName})` : `${role} (Ocupado - ${memberName})`;
                            %>
                                <option value="<%= role %>" disabled class="tds-role-occupied"><%= roleLabel %></option>
                            <%
                                    }
                                });
                            %>
                        </select>
                        <div class="tds-select-arrow">
                            <i class="fas fa-chevron-down"></i>
                        </div>
                        <div class="tds-select-focus-ring"></div>
                    </div>
                    <div class="tds-form-help">Solo se permite un jugador por rol.</div>
                </div>
                
                <div class="tds-form-actions">
                    <button type="submit" class="tds-btn tds-btn-primary">
                        <i class="fas fa-paper-plane"></i>
                        <span>Enviar Invitación</span>
                        <div class="tds-btn-loading">
                            <i class="fas fa-spinner fa-spin"></i>
                        </div>
                    </button>
                    <button type="button" class="tds-btn tds-btn-outline tds-close-modal">
                        <i class="fas fa-times"></i>
                        <span>Cancelar</span>
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Edit Team Modal -->
<div id="tdsEditTeamModal" class="tds-modal">
    <div class="tds-modal-overlay"></div>
    <div class="tds-modal-container">
        <div class="tds-modal-header">
            <div class="tds-modal-title">
                <i class="fas fa-edit"></i>
                <h3>Editar Equipo</h3>
            </div>
            <button class="tds-modal-close">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="tds-modal-body">
            <form id="tdsEditTeamForm" action="/edit-team" method="POST" enctype="multipart/form-data" class="tds-form">
                <input type="hidden" name="team_id" value="<%= team.id_team %>">
                
                <div class="tds-form-group">
                    <label for="tdsTeamName" class="tds-form-label">
                        <i class="fas fa-font"></i>
                        Nombre del Equipo
                    </label>
                    <div class="tds-input-wrapper">
                        <input type="text" id="tdsTeamName" name="team_name" class="tds-form-input" 
                               value="<%= team.name %>" placeholder="Nombre del equipo" required>
                        <div class="tds-input-focus-ring"></div>
                    </div>
                </div>
                
                <div class="tds-form-group">
                    <label for="tdsTeamTag" class="tds-form-label">
                        <i class="fas fa-tag"></i>
                        Tag del Equipo
                    </label>
                    <div class="tds-input-wrapper">
                        <input type="text" id="tdsTeamTag" name="team_tag" class="tds-form-input" 
                               value="<%= team.tag %>" placeholder="TAG" maxlength="5" minlength="2" required>
                        <div class="tds-input-focus-ring"></div>
                    </div>
                    <div class="tds-form-help">Entre 2 y 5 caracteres</div>
                </div>
                
                <div class="tds-form-group">
                    <label for="tdsTeamDescription" class="tds-form-label">
                        <i class="fas fa-align-left"></i>
                        Descripción
                    </label>
                    <div class="tds-textarea-wrapper">
                        <textarea id="tdsTeamDescription" name="team_description" class="tds-form-textarea" 
                                  placeholder="Describe tu equipo..." rows="3"><%= team.description %></textarea>
                        <div class="tds-textarea-focus-ring"></div>
                    </div>
                </div>
                
                <div class="tds-form-group">
                    <label for="tdsTeamLogo" class="tds-form-label">
                        <i class="fas fa-image"></i>
                        Logo del Equipo
                    </label>
                    
                    <% if (team.logo_path) { %>
                        <div class="tds-current-logo-section">
                            <div class="tds-current-logo-header">
                                <span class="tds-current-logo-label">Logo actual:</span>
                            </div>
                            <div class="tds-current-logo-container">
                                <img src="<%= team.logo_path %>" alt="Current Logo" class="tds-current-logo">
                            </div>
                        </div>
                    <% } %>
                    
                    <div class="tds-file-upload-area" id="tdsFileUploadArea">
                        <input type="file" id="tdsTeamLogo" name="team_logo" accept="image/*" class="tds-file-input">
                        <div class="tds-file-upload-content">
                            <div class="tds-file-upload-icon">
                                <i class="fas fa-cloud-upload-alt"></i>
                            </div>
                            <div class="tds-file-upload-text">
                                <span class="tds-file-upload-main">Arrastra tu logo aquí o haz clic para seleccionar</span>
                                <span class="tds-file-upload-sub">PNG, JPG, GIF hasta 5MB</span>
                            </div>
                        </div>
                        <div class="tds-file-preview" id="tdsFilePreview" style="display: none;">
                            <img id="tdsPreviewImage" src="/placeholder.svg" alt="Preview">
                            <div class="tds-file-info">
                                <span id="tdsFileName"></span>
                                <button type="button" class="tds-file-remove" id="tdsRemoveFile">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="tds-form-actions">
                    <button type="submit" class="tds-btn tds-btn-primary">
                        <i class="fas fa-save"></i>
                        <span>Guardar Cambios</span>
                        <div class="tds-btn-loading">
                            <i class="fas fa-spinner fa-spin"></i>
                        </div>
                    </button>
                    <button type="button" class="tds-btn tds-btn-outline tds-close-modal">
                        <i class="fas fa-times"></i>
                        <span>Cancelar</span>
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Leave/Delete Team Modal -->
<div id="tdsLeaveTeamModal" class="tds-modal">
    <div class="tds-modal-overlay"></div>
    <div class="tds-modal-container">
        <div class="tds-modal-header">
            <div class="tds-modal-title">
                <i class="fas fa-<%= isTeamCaptain ? 'trash-alt' : 'sign-out-alt' %>"></i>
                <h3><%= isTeamCaptain ? 'Eliminar Equipo' : 'Abandonar Equipo' %></h3>
            </div>
            <button class="tds-modal-close">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="tds-modal-body">
            <div class="tds-confirmation-content">
                <% if (isTeamCaptain) { %>
                    <div class="tds-warning-icon">
                        <i class="fas fa-exclamation-triangle"></i>
                    </div>
                    <div class="tds-confirmation-text">
                        <p>¿Estás seguro de que deseas eliminar el equipo "<strong><%= team.name %></strong>"?</p>
                        <p class="tds-warning-text">Esta acción no se puede deshacer. Todos los miembros serán removidos y el equipo será eliminado permanentemente.</p>
                    </div>
                    
                    <div class="tds-form-actions">
                        <form action="/delete-team" method="POST">
                            <input type="hidden" name="team_id" value="<%= team.id_team %>">
                            <button type="submit" class="tds-btn tds-btn-danger">
                                <i class="fas fa-trash-alt"></i>
                                <span>Eliminar Equipo</span>
                            </button>
                            <button type="button" class="tds-btn tds-btn-outline tds-close-modal">
                                <i class="fas fa-times"></i>
                                <span>Cancelar</span>
                            </button>
                        </form>
                    </div>
                <% } else { %>
                    <div class="tds-warning-icon">
                        <i class="fas fa-door-open"></i>
                    </div>
                    <div class="tds-confirmation-text">
                        <p>¿Estás seguro de que deseas abandonar el equipo "<strong><%= team.name %></strong>"?</p>
                    </div>
                    
                    <div class="tds-form-actions">
                        <form action="/leave-team" method="POST">
                            <input type="hidden" name="team_id" value="<%= team.id_team %>">
                            <button type="submit" class="tds-btn tds-btn-danger">
                                <i class="fas fa-sign-out-alt"></i>
                                <span>Abandonar Equipo</span>
                            </button>
                            <button type="button" class="tds-btn tds-btn-outline tds-close-modal">
                                <i class="fas fa-times"></i>
                                <span>Cancelar</span>
                            </button>
                        </form>
                    </div>
                <% } %>
            </div>
        </div>
    </div>
</div>

<script>
// Global functions for team details management
function tdsOpenModal(modalId) {
    const modal = document.getElementById(modalId);
    if (modal) {
        modal.style.display = 'block';
        document.body.style.overflow = 'hidden';
    }
}

function tdsCloseModal(modalId) {
    const modal = document.getElementById(modalId);
    if (modal) {
        modal.style.display = 'none';
        document.body.style.overflow = '';
    }
}

document.addEventListener('DOMContentLoaded', function() {
    // Modal functionality
    const modals = ['tdsInvitePlayerModal', 'tdsEditTeamModal', 'tdsLeaveTeamModal'];
    const buttons = {
        'tdsInvitePlayerBtn': 'tdsInvitePlayerModal',
        'tdsEditTeamBtn': 'tdsEditTeamModal',
        'tdsLeaveTeamBtn': 'tdsLeaveTeamModal'
    };
    
    // Open modals
    Object.keys(buttons).forEach(buttonId => {
        const button = document.getElementById(buttonId);
        if (button) {
            button.addEventListener('click', () => {
                tdsOpenModal(buttons[buttonId]);
            });
        }
    });
    
    // Close modals
    modals.forEach(modalId => {
        const modal = document.getElementById(modalId);
        if (modal) {
            const closeBtn = modal.querySelector('.tds-modal-close');
            const closeBtns = modal.querySelectorAll('.tds-close-modal');
            const overlay = modal.querySelector('.tds-modal-overlay');
            
            if (closeBtn) {
                closeBtn.addEventListener('click', () => tdsCloseModal(modalId));
            }
            
            closeBtns.forEach(btn => {
                btn.addEventListener('click', () => tdsCloseModal(modalId));
            });
            
            if (overlay) {
                overlay.addEventListener('click', () => tdsCloseModal(modalId));
            }
        }
    });
    
    // File upload functionality
    const fileUploadArea = document.getElementById('tdsFileUploadArea');
    const fileInput = document.getElementById('tdsTeamLogo');
    const filePreview = document.getElementById('tdsFilePreview');
    const previewImage = document.getElementById('tdsPreviewImage');
    const fileName = document.getElementById('tdsFileName');
    const removeFileBtn = document.getElementById('tdsRemoveFile');
    const uploadContent = document.querySelector('.tds-file-upload-content');
    
    // Drag and drop
    if (fileUploadArea) {
        fileUploadArea.addEventListener('dragover', function(e) {
            e.preventDefault();
            this.classList.add('tds-dragover');
        });
        
        fileUploadArea.addEventListener('dragleave', function(e) {
            e.preventDefault();
            this.classList.remove('tds-dragover');
        });
        
        fileUploadArea.addEventListener('drop', function(e) {
            e.preventDefault();
            this.classList.remove('tds-dragover');
            
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                handleFileSelect(files[0]);
            }
        });
    }
    
    // File input change
    if (fileInput) {
        fileInput.addEventListener('change', function() {
            if (this.files.length > 0) {
                handleFileSelect(this.files[0]);
            }
        });
    }
    
    // Remove file
    if (removeFileBtn) {
        removeFileBtn.addEventListener('click', function() {
            fileInput.value = '';
            filePreview.style.display = 'none';
            uploadContent.style.display = 'block';
        });
    }
    
    function handleFileSelect(file) {
        // Validate file
        if (!file.type.match('image.*')) {
            alert('Solo se permiten archivos de imagen.');
            return;
        }
        
        if (file.size > 5 * 1024 * 1024) {
            alert('El archivo es demasiado grande. El tamaño máximo es 5MB.');
            return;
        }
        
        // Show preview
        const reader = new FileReader();
        reader.onload = function(e) {
            previewImage.src = e.target.result;
            fileName.textContent = file.name;
            filePreview.style.display = 'flex';
            uploadContent.style.display = 'none';
        };
        reader.readAsDataURL(file);
    }
    
    // Form submissions with loading states
    const forms = document.querySelectorAll('.tds-form');
    forms.forEach(form => {
        form.addEventListener('submit', function(e) {
            const submitBtn = this.querySelector('button[type="submit"]');
            if (submitBtn) {
                submitBtn.classList.add('tds-loading');
                submitBtn.disabled = true;
            }
        });
    });
    
    // Close modals on escape key
    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
            modals.forEach(modalId => {
                const modal = document.getElementById(modalId);
                if (modal && modal.style.display === 'block') {
                    tdsCloseModal(modalId);
                }
            });
        }
    });
    
    // Animate elements on load
    const cards = document.querySelectorAll('.tds-sidebar-section, .tds-section-card');
    cards.forEach((card, index) => {
        card.style.opacity = '0';
        card.style.transform = 'translateY(20px)';
        
        setTimeout(() => {
            card.style.transition = 'all 0.6s ease';
            card.style.opacity = '1';
            card.style.transform = 'translateY(0)';
        }, index * 200 + 300);
    });
    
    // Auto-hide alerts after 5 seconds
    const alerts = document.querySelectorAll('.tds-alert');
    alerts.forEach(alert => {
        setTimeout(() => {
            alert.style.opacity = '0';
            alert.style.transform = 'translateY(-10px)';
            setTimeout(() => {
                alert.remove();
            }, 300);
        }, 5000);
    });
});
</script>

<%- include('partials/footer') %>